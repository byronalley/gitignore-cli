#!ruby

require "gitignore"
require "tty-prompt"

command = ARGV[0]

case command
when "list"
  Gitignore.list.each do |env|
    puts " - #{env}"
  end

when "generate", "g"
  envs = ARGV[1..-1]
  puts Gitignore.generate(envs)

when "create"
  prompt = TTY::Prompt.new

  env_list = Gitignore.list
  results = prompt.multi_select(
    "Select envs to generate the .gitignore?", env_list, filter: true
  )

  unless results.any?
    puts "No environment selected... exiting!"
    exit
  end

  file = File.open('.gitignore', 'w')
  file.write(Gitignore.generate(results))
  file.close

  puts "The .gitignore is generated!"

else
  puts <<~HELP
Usage: #{File.basename($0)} [command] [options]

Commonly used command are:
       list :     list all environment options
     create :     generate a .gitignore file using a interactive term ui
   generate :     generate a .gitignore file by all environment that you choose
  HELP
end
